import{d as e,r as l,a,b as s,h as o,e as t,w as n,n as r,g as u,u as d,f as i,p as c,c as p,t as m,q as f,F as _,s as g,y as v,_ as w,j as y,E as h,G as b,v as V}from"./index-5c3c44fe.js";import{_ as k,b as $,a as x}from"./NavBar.c3c1f6a6.js";import{_ as C,a as L,b as j}from"./uni-forms.af745596.js";import{_ as M}from"./uni-popup.fc0b29ff.js";import{u as q}from"./useLocale.1b37ce39.js";const F=x(e({__name:"recovery",setup(e){const{t:x}=q(),F=l({title:x("login.recovery"),backgroundColor:"transparent",textColor:"#fff",isBack:!0}),P=l(null),U=l(null),B=l(1),E=l({email:"",password:"",password2:"",code:""}),T={email:{rules:[{required:!0,errorMessage:"please input your email"}]},password:{rules:[{required:!0,errorMessage:"please input your password"},{minLength:8,maxLength:16,errorMessage:"Length should be 8 to 16"}]},password2:{rules:[{required:!0,errorMessage:"please input your Confirm password"},{minLength:8,maxLength:16,errorMessage:"Length should be 8 to 16"},{validateFunction:function(e,l,a,s){return l!==a.password&&s("Two inputs don't match!"),!0}}]}};a((()=>{}));const z=()=>{P.value.validate().then((()=>{!async function(){let e={email:E.value.email};const[l,a]=await v.resetPasswordCodeSend(e);!l&&a&&(null==a?void 0:a.success)&&(g({icon:"none",title:"send success"}),U.value.open())}()})).catch((e=>{console.log("err",e)}))},G=()=>{P.value.validate().then((()=>{!async function(){let e={email:E.value.email,password:E.value.password,verificationCode:E.value.code};const[l,a]=await v.resetPassword(e);!l&&a&&((null==a?void 0:a.success)?(g({icon:"none",title:"reset success"}),setTimeout((()=>{w({url:"/pages/user/login"})}),1e3)):(E.value.password2="",E.value.password="",E.value.code="",B.value=1))}()})).catch((e=>{console.log("err",e)}))},I=()=>{U.value.close()},N=()=>{E.value.code?(U.value.close(),B.value=2):g({icon:"none",title:"please input code"})};return(e,l)=>{const a=k,g=y,v=h(b("uni-easyinput"),C),w=h(b("uni-forms-item"),L),x=h(b("uni-forms"),j),q=h(b("uni-icons"),$),S=V,A=h(b("uni-popup"),M);return s(),o(_,null,[t(g,{class:"recovery"},{default:n((()=>[t(a,r(u(d(F))),null,16),t(g,{class:"steps"},{default:n((()=>[t(g,{class:"line"},{default:n((()=>[t(g,{class:"round left act"},{default:n((()=>[i("1")])),_:1}),t(g,{class:c(2===d(B)?"round right act":"round right")},{default:n((()=>[i("2")])),_:1},8,["class"])])),_:1})])),_:1}),1===d(B)?(s(),p(g,{key:0,class:"info"},{default:n((()=>[t(g,{class:"title"},{default:n((()=>[i(m(e.$t("login.info")),1)])),_:1}),t(g,{class:"form"},{default:n((()=>[t(x,{ref_key:"loginForm",ref:P,rules:T,modelValue:d(E),"label-position":"top"},{default:n((()=>[t(w,{label:e.$t("login.email")+":",name:"email"},{default:n((()=>[t(v,{modelValue:d(E).email,"onUpdate:modelValue":l[0]||(l[0]=e=>d(E).email=e),placeholder:""},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["modelValue"]),t(g,{class:"login-btn",onClick:z},{default:n((()=>[i(m(e.$t("login.next")),1)])),_:1})])),_:1})])),_:1})):f("v-if",!0),2===d(B)?(s(),p(g,{key:1,class:"info"},{default:n((()=>[t(g,{class:"title"},{default:n((()=>[i(m(e.$t("login.new")),1)])),_:1}),t(g,{class:"form"},{default:n((()=>[t(x,{ref_key:"loginForm",ref:P,rules:T,modelValue:d(E),"label-position":"top"},{default:n((()=>[t(w,{label:e.$t("login.newPassword")+":",name:"password"},{default:n((()=>[t(v,{modelValue:d(E).password,"onUpdate:modelValue":l[1]||(l[1]=e=>d(E).password=e),type:"password",placeholder:""},null,8,["modelValue"])])),_:1},8,["label"]),t(w,{label:e.$t("login.confirmPassword")+":",type:"password",name:"password2"},{default:n((()=>[t(v,{modelValue:d(E).password2,"onUpdate:modelValue":l[2]||(l[2]=e=>d(E).password2=e),placeholder:"",type:"password"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["modelValue"]),t(g,{class:"login-btn",onClick:G},{default:n((()=>[i(m(e.$t("login.confirm")),1)])),_:1})])),_:1})])),_:1})):f("v-if",!0)])),_:1}),t(A,{ref_key:"popup",ref:U,"is-mask-click":!1,type:"bottom"},{default:n((()=>[t(g,{class:"pop"},{default:n((()=>[t(g,{class:"close"},{default:n((()=>[t(q,{type:"closeempty",size:"20",color:"#000",onClick:I})])),_:1}),t(g,{class:"title"},{default:n((()=>[i(m(e.$t("login.code")),1)])),_:1}),t(g,{class:"text m-tb-20"},{default:n((()=>[i(m(e.$t("login.text")),1)])),_:1}),t(g,null,{default:n((()=>[t(v,{modelValue:d(E).code,"onUpdate:modelValue":l[3]||(l[3]=e=>d(E).code=e),type:"number",placeholder:e.$t("login.code")},null,8,["modelValue","placeholder"])])),_:1}),t(g,{class:"text"},{default:n((()=>[i(m(e.$t("login.resend"))+" ",1),t(S,{class:"text-BE9670"},{default:n((()=>[i(m(e.$t("login.resend2")),1)])),_:1})])),_:1}),t(g,{class:"btn m-t-30",onClick:N},{default:n((()=>[i(m(e.$t("login.verify")),1)])),_:1})])),_:1})])),_:1},512)],64)}}}),[["__scopeId","data-v-93cd4367"]]);export{F as default};
