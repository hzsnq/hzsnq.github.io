import{a as V}from"./index-62d2fc31.js";/* empty css                     *//* empty css                *//* empty css                 */import{d as z,r as S,o as K,C as M,u as q,a as D,D as I,b as L,g as T,i as v,f as o,c as P,w as h,G as B,H as $,v as N,x as G,I as W,J as Y,e as f,K as O,L as J,k as F,M as U,N as Q,O as X,P as Z,Q as ee,_ as te}from"./index-53be2c6b.js";import{u as re}from"./useUser-a1bf5fc0.js";import{i as oe}from"./validate-add6ff74.js";const ne=""+new URL("login-icon-1d114a88.png",import.meta.url).href;function A(){return A=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(i[c]=t[c])}return i},A.apply(this,arguments)}var ae=function(){var e=!1,t=[],c=function(){if(!e){e=!0;for(var l=0,y=t.length;l<y;l++)t[l]()}},u=function(l){if(!e){t.push(l);return}l()},w={resolved:function(){return e},resolve:c,promise:{then:u}};return w},j=Object.prototype.hasOwnProperty;function se(){var i=ae();return{notify:function(){i.resolve()},wait:function(){return i.promise},render:function(t,c,u){this.wait().then(function(){u(window.grecaptcha.render(t,c))})},reset:function(t){typeof t>"u"||(this.assertLoaded(),this.wait().then(function(){return window.grecaptcha.reset(t)}))},execute:function(t){typeof t>"u"||(this.assertLoaded(),this.wait().then(function(){return window.grecaptcha.execute(t)}))},checkRecaptchaLoad:function(){j.call(window,"grecaptcha")&&j.call(window.grecaptcha,"render")&&this.notify()},assertLoaded:function(){if(!i.resolved())throw new Error("ReCAPTCHA has not been loaded")}}}var k=se();typeof window<"u"&&(window.vueRecaptchaApiLoaded=k.notify);var ie=z({name:"VueRecaptcha",props:{sitekey:{type:String,required:!0},theme:{type:String},badge:{type:String},type:{type:String},size:{type:String},tabindex:{type:String},loadRecaptchaScript:{type:Boolean,default:!0},recaptchaScriptId:{type:String,default:"__RECAPTCHA_SCRIPT"},recaptchaHost:{type:String,default:"www.google.com"},language:{type:String,default:""}},emits:["render","verify","expired","error"],setup:function(e,t){var c=t.slots,u=t.emit,w=S(null),g=S(null),l=function(x){u("verify",x)},y=function(){u("expired")},a=function(){u("error")};return K(function(){if(k.checkRecaptchaLoad(),e.loadRecaptchaScript&&!document.getElementById(e.recaptchaScriptId)){var n=document.createElement("script");n.id=e.recaptchaScriptId,n.src="https://"+e.recaptchaHost+"/recaptcha/api.js?onload=vueRecaptchaApiLoaded&render=explicit&hl="+e.language,n.async=!0,n.defer=!0,document.head.appendChild(n)}var x=A({},e,{callback:l,"expired-callback":y,"error-callback":a}),E=w.value,p=c.default?E.children[0]:E;k.render(p,x,function(r){g.value=r,u("render",r)})}),{root:w,widgetId:g,reset:function(){k.reset(g.value)},execute:function(){k.execute(g.value)}}},render:function(){var e=this.$slots.default,t;return typeof e=="function"?t=e():t=e,M("div",{ref:"root"},t)}});const C=i=>(N("data-v-047227bd"),i=i(),G(),i),le={class:"login-container"},de={class:"login-card"},ce=C(()=>v("div",{class:"title"},[v("img",{src:ne})],-1)),ue={class:"content"},pe={class:"flex-between"},me=C(()=>v("div",null,null,-1)),fe={class:"flex"},ge={class:"flex-between"},he=C(()=>v("div",null,null,-1)),ve=z({__name:"index",setup(i){const e=q(),t=S("login"),c=D(),u=S(),w=S(),{setUserInfo:g}=re();let l=[];l["Super Admin"]="superAdmin",l["Fund Admin"]="fundAdmin",l["Fund Operation"]="fundOperation",l["Web Admin"]="webAdmin";const y=(p,r,m)=>{r===""?m(new Error("Please input Email")):oe(r)?m():m(new Error("Email format is incorrect!"))},a=I({loading:!1,loginForm:{username:"",password:""},loginRules:{username:[{required:!0,message:"please enter email",trigger:"blur"}],password:[{required:!0,message:"Please enter password",trigger:"blur"}]},handleLogin:()=>{u.value.validate(async p=>{var r;if(p){a.loading=!0;const m={adminUserEmail:a.loginForm.username,password:a.loginForm.password},[_,s]=await V.userLogin(m);if(!_&&s)if(s!=null&&s.success){const b=(r=s==null?void 0:s.data)!=null&&r.roles?[l[s==null?void 0:s.data.roles[0]]]:[];let R={token:s.data.token,roles:b,adminEmail:s.data.adminEmail};g(R),a.loading=!1;try{const d=R.roles;e.setRoutes(d),e.dynamicRoutes.forEach(H=>{W.addRoute(H)})}catch(d){console.log(d)}c.push({path:b[0]==="webAdmin"?"/investment":"/"}).catch(d=>{console.warn(d)})}else a.loading=!1;else console.log(_)}else return!1})}}),n=I({loading:!1,resetForm:{username:""},resetRules:{username:[{required:!0,message:"please enter email",trigger:"blur"},{validator:y,trigger:"blur"}]},handleReset:()=>{w.value.validate(async p=>{if(p){a.loading=!0;const r={adminEmail:n.resetForm.username},[m,_]=await V.sendPasswordResetEmail(r);!m&&_&&(a.loading=!1,Y.success("Send email success"))}else return!1})}}),x=p=>{window.localStorage.setItem("g-recaptcha-response",p)},E=p=>{t.value=p};return(p,r)=>{const m=Q,_=X,s=Z,b=ee,R=$;return L(),T("div",le,[v("div",de,[ce,v("div",ue,[o(t)==="login"?(L(),P(R,{key:0,ref_key:"loginFormDom",ref:u,model:o(a).loginForm,rules:o(a).loginRules,onKeyup:B(o(a).handleLogin,["enter"])},{default:h(()=>[f(_,{prop:"username"},{default:h(()=>[f(m,{modelValue:o(a).loginForm.username,"onUpdate:modelValue":r[0]||(r[0]=d=>o(a).loginForm.username=d),placeholder:"Email",type:"text",tabindex:"1","prefix-icon":o(O),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),f(_,{prop:"password"},{default:h(()=>[f(m,{modelValue:o(a).loginForm.password,"onUpdate:modelValue":r[1]||(r[1]=d=>o(a).loginForm.password=d),placeholder:"Password",type:"password",tabindex:"2","prefix-icon":o(J),size:"large","show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),v("div",pe,[me,f(s,{class:"m-b-10",type:"info",onClick:r[2]||(r[2]=d=>E("reset"))},{default:h(()=>[F("Forgot your password?")]),_:1})]),v("div",fe,[f(o(ie),{sitekey:"6LcWhv4jAAAAACe2U7tz5Rhstqkf-whriMrj3YYG",onVerify:x})]),f(b,{loading:o(a).loading,type:"primary",size:"large",color:"#BE9670",onClick:U(o(a).handleLogin,["prevent"])},{default:h(()=>[F(" Log in ")]),_:1},8,["loading","onClick"])]),_:1},8,["model","rules","onKeyup"])):(L(),P(R,{key:1,ref_key:"resetFormDom",ref:w,model:o(n).resetForm,rules:o(n).resetRules,onKeyup:B(o(n).handleReset,["enter"])},{default:h(()=>[f(_,{prop:"username"},{default:h(()=>[f(m,{modelValue:o(n).resetForm.username,"onUpdate:modelValue":r[3]||(r[3]=d=>o(n).resetForm.username=d),placeholder:"Email",type:"text",tabindex:"1","prefix-icon":o(O),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),v("div",ge,[he,f(s,{class:"m-b-10",type:"info",onClick:r[4]||(r[4]=d=>E("login"))},{default:h(()=>[F("Log in")]),_:1})]),f(b,{loading:o(n).loading,type:"primary",size:"large",color:"#BE9670",onClick:U(o(n).handleReset,["prevent"])},{default:h(()=>[F(" Send me reset password instructions ")]),_:1},8,["loading","onClick"])]),_:1},8,["model","rules","onKeyup"]))])])])}}});const ke=te(ve,[["__scopeId","data-v-047227bd"]]);export{ke as default};
