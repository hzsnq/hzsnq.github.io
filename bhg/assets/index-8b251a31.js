import{a as S}from"./index-06066bd7.js";/* empty css                   *//* empty css                 *//* empty css                 *//* empty css                   *//* empty css                  */import{i as fe,_ as Se}from"./index-68a634a2.js";import{d as ge,o as ye,r as p,D as ie,b as u,g as _,i as r,t as q,f as l,e,w as n,k as R,a0 as be,F as L,h as B,c as z,Z as pe,ar as me,l as W,T as H,J as X,E as Ie,Q as he,a1 as Ce,a2 as Re,O as Ue,a3 as De,N as ke,ab as Te,H as qe,V as we,W as Ee,a9 as Ve,v as Ne,x as xe,_ as $e,a4 as _e,a5 as Be,X as ze,a6 as Oe,a7 as je,a8 as Me,j as He,$ as Ke,Y as Ye}from"./index-1ae8a691.js";import{u as Ge}from"./AppMain.vue_vue_type_style_index_0_scoped_41d4e859_lang-da327601.js";/* empty css                     *//* empty css                    *//* empty css                  */import{P as Le}from"./index-e099722b.js";import"./useUser-15c0fb72.js";const Ae=Symbol("referral"),Fe=A=>(Ne("data-v-6acc49cb"),A=A(),xe(),A),Je={class:"pop-top"},Qe={class:"title"},We={class:"form"},Xe={class:"block padding-t-20"},Ze={class:"block padding-t-20"},el={class:"flex"},ll={class:"level"},tl={key:0,class:"list"},al=["onClick"],nl={class:"text-cut"},ol={class:"level"},sl={key:0,class:"list"},il=["onClick"],rl={class:"text-cut"},dl={class:"block padding-t-20"},ul={key:0,class:"block padding-t-20"},cl=Fe(()=>r("div",{class:"table-title"},"Current Total Amount",-1)),fl={key:1,class:"block padding-t-20"},pl=Fe(()=>r("div",{class:"table-title"},"Commission Payment Records",-1)),ml={class:"dialog-footer"},_l=ge({__name:"CreateOrEditReferral",setup(A){const{rId:k}=fe(Ae),{func:U}=fe(Le);ye(async()=>{await te(),await ae(),k.value&&V()});const O=p([]),K=p([]),F=p([]),P=p([]),w=p({}),E=p([]),Y=p(),J=p(),i=ie({clientId:"",entityId:"",fundId:"",gst:!1,commissionRate:"",currency:"",referralAgreement:"",refList:[]}),v=p(!1),j=p("add"),C=p(null),N=p(null),c=ie({clientId:"",entityId:"",id:"",financeId:""}),Z=ie({clientId:[{required:!0,message:"Please select client",trigger:"change"}],entityId:[{required:!0,message:"Please select entity",trigger:"change"}],fundId:[{required:!0,message:"Please select fund",trigger:"change"}],gst:[{required:!0,message:"Please choose gst",trigger:"change"}],commissionRate:[{required:!0,message:"Please input Commission Rate",trigger:"blur"}],refList:[{required:!0,message:"Please input Referral",trigger:"blur"}]}),le=async s=>{s&&await s.validate((t,o)=>{if(t){if(console.log("submit!"),i.refList.length<=0){X.error("Please input Referral");return}i.referralAgreement=E.value.length>0?E.value[0].raw:"",k.value?D():f()}else X.error("Please enter correct content!"),console.log("error submit!",o)})};async function te(){let s={};const[t,o]=await S.getClientsNames(s);!t&&o&&(O.value=(o==null?void 0:o.data)||[])}async function ae(){let s={};const[t,o]=await S.getFundsNames(s);!t&&o&&(K.value=(o==null?void 0:o.data)||[])}const ne=()=>{i.clientId?de():(i.entityId="",F.value=[])},oe=()=>{c.clientId?b():(c.entityId="",P.value=[])};async function de(){if(!i.clientId)return;let s={clientId:i.clientId};const[t,o]=await S.queryEntity(s);!t&&o&&(F.value=(o==null?void 0:o.data)||[])}async function b(){if(!c.clientId)return;let s={clientId:c.clientId};const[t,o]=await S.queryEntity(s);!t&&o&&(P.value=(o==null?void 0:o.data)||[])}async function f(){let s=i;const[t,o]=await S.createReferral(s);!t&&o&&o.success&&(X.success("Created successfully"),setTimeout(()=>{U()},1e3))}async function D(){let s={...i,id:k.value};console.log(s);const[t,o]=await S.updateReferral(s);!t&&o&&o.success&&(X.success("Edit successfully"),setTimeout(()=>{U()},1e3))}async function V(){var g,h,y,d,$,Q,ee;let s={id:k.value};const[t,o]=await S.queryFinancingById(s);!t&&o&&(console.log(o.data),w.value=o.data,i.clientId=((g=o.data)==null?void 0:g.clientId)||"",i.entityId=((h=o.data)==null?void 0:h.entityId)||"",i.fundId=((y=o.data)==null?void 0:y.fundId)||"",i.gst=((d=o.data)==null?void 0:d.gst)||!1,i.refList=(($=o.data)==null?void 0:$.refList)||[],i.commissionRate=((Q=o.data)==null?void 0:Q.commissionRate)||"",i.currency=((ee=o.data)==null?void 0:ee.currency)||"")}const M=s=>{j.value="add",N.value=s,P.value=[],c.clientId="",c.entityId="",v.value=!0},x=async s=>{s&&await s.validate((t,o)=>{if(t){const g=O.value.find(y=>y.id===c.clientId),h=P.value.find(y=>y.id===c.entityId);j.value==="add"?i.refList.push({clientId:c.clientId,clientName:g.name,entityId:c.entityId,entityName:h.entityName,level:N.value}):(console.log("edit"),i.refList[C.value].clientId=c.clientId,i.refList[C.value].clientName=g.name,i.refList[C.value].entityName=h.entityName,i.refList[C.value].entityId=c.entityId),v.value=!1}else console.log("error submit!",o)})},T=s=>{i.refList.splice(s,1)},I=(s,t)=>{console.log(s),C.value=t,j.value="edit",c.clientId=Number(s.clientId),c.entityId=Number(s.entityId),N.value=s.level,s!=null&&s.id&&(c.id=s==null?void 0:s.id),s!=null&&s.financeId&&(c.financeId=s==null?void 0:s.financeId),P.value=[],b(),v.value=!0};return(s,t)=>{const o=Ie,g=he,h=Ce,y=Re,d=Ue,$=De,Q=ke,ee=Te,ue=qe,G=we,ce=Ee,Pe=Ve;return u(),_(L,null,[r("div",Je,[r("div",Qe,q(l(k)?"Edit Referral":"Create Referral"),1),r("div",null,[e(g,{type:"primary",color:"#4E9F1C",onClick:t[0]||(t[0]=a=>le(l(Y)))},{default:n(()=>[R(q(l(k)?"Edit Referral":"New Referral")+" ",1),e(o,null,{default:n(()=>[e(l(be))]),_:1})]),_:1})])]),r("div",We,[e(ue,{ref_key:"ruleFormRef",ref:Y,model:l(i),rules:l(Z),"label-width":"200px","status-icon":""},{default:n(()=>[r("div",Xe,[e(d,{label:"Client",prop:"clientId"},{default:n(()=>[e(y,{modelValue:l(i).clientId,"onUpdate:modelValue":t[1]||(t[1]=a=>l(i).clientId=a),placeholder:"Please Client",filterable:"",clearable:"",onChange:ne},{default:n(()=>[(u(!0),_(L,null,B(l(O),(a,m)=>(u(),z(h,{label:a.name,value:a.id,key:m},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"Entity Name",prop:"entityId"},{default:n(()=>[e(y,{modelValue:l(i).entityId,"onUpdate:modelValue":t[2]||(t[2]=a=>l(i).entityId=a),placeholder:"Please Entity Name",filterable:"",clearable:""},{default:n(()=>[(u(!0),_(L,null,B(l(F),(a,m)=>(u(),z(h,{label:a.entityName,value:a.id,key:m},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"Fund",prop:"fundId"},{default:n(()=>[e(y,{modelValue:l(i).fundId,"onUpdate:modelValue":t[3]||(t[3]=a=>l(i).fundId=a),placeholder:"Please Fund",filterable:"",clearable:""},{default:n(()=>[(u(!0),_(L,null,B(l(K),(a,m)=>(u(),z(h,{label:a.name,value:a.id,key:m},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"GST",prop:"gst"},{default:n(()=>[e($,{modelValue:l(i).gst,"onUpdate:modelValue":t[4]||(t[4]=a=>l(i).gst=a),"active-text":"Yes","inactive-text":"No"},null,8,["modelValue"])]),_:1})]),r("div",Ze,[e(d,{label:"Referral",prop:"refList"},{default:n(()=>[r("div",el,[r("div",ll,[(u(!0),_(L,null,B(l(i).refList,(a,m)=>(u(),_("div",{class:"line",key:m},[a.level===2?(u(),_("div",tl,[r("div",{class:"item",onClick:se=>I(a,m)},[r("div",nl,q(a.clientName)+","+q(a.entityName),1),e(o,null,{default:n(()=>[e(l(pe))]),_:1})],8,al),e(o,{class:"bg-grey",size:"14",color:"#fff",onClick:se=>T(m)},{default:n(()=>[e(l(me))]),_:2},1032,["onClick"])])):W("",!0)]))),128)),e(g,{class:"margin-t-10",onClick:t[5]||(t[5]=a=>M(2))},{default:n(()=>[R(" +Add level1 ")]),_:1})]),r("div",ol,[(u(!0),_(L,null,B(l(i).refList,(a,m)=>(u(),_("div",{class:"line",key:m},[a.level===3?(u(),_("div",sl,[r("div",{class:"item",onClick:se=>I(a,m)},[r("div",rl,q(a.clientName)+","+q(a.entityName),1),e(o,null,{default:n(()=>[e(l(pe))]),_:1})],8,il),e(o,{class:"bg-grey",size:"14",color:"#fff",onClick:se=>T(m)},{default:n(()=>[e(l(me))]),_:2},1032,["onClick"])])):W("",!0)]))),128)),e(g,{class:"margin-t-10",onClick:t[6]||(t[6]=a=>M(3))},{default:n(()=>[R(" +Add level2 ")]),_:1})])])]),_:1})]),r("div",dl,[e(d,{label:"Total Financing Amount"},{default:n(()=>{var a;return[R(" $"+q(((a=l(w))==null?void 0:a.financingAmount)||0),1)]}),_:1}),e(d,{label:"Commission Rate",prop:"commissionRate"},{default:n(()=>[e(Q,{modelValue:l(i).commissionRate,"onUpdate:modelValue":t[7]||(t[7]=a=>l(i).commissionRate=a),type:"number"},null,8,["modelValue"])]),_:1}),e(d,{label:"Currency",prop:"currency"},{default:n(()=>[e(Q,{modelValue:l(i).currency,"onUpdate:modelValue":t[8]||(t[8]=a=>l(i).currency=a)},null,8,["modelValue"])]),_:1}),e(d,{label:"Referral Agreement",prop:"referralAgreement"},{default:n(()=>[e(ee,{"file-list":l(E),"onUpdate:fileList":t[9]||(t[9]=a=>H(E)?E.value=a:null),"auto-upload":!1,limit:1,"list-type":"text"},{trigger:n(()=>[e(g,{type:"primary"},{default:n(()=>[R("Choose file")]),_:1})]),_:1},8,["file-list"])]),_:1})])]),_:1},8,["model","rules"]),l(k)?(u(),_("div",ul,[cl,e(ce,{data:l(w).subClientsCurrentTotalReturnResponses,height:"240","row-style":{height:"30px"},"header-cell-style":{background:"#BE9670",color:"#fff"}},{default:n(()=>[e(G,{prop:"name",label:"Client Name",align:"center"}),e(G,{prop:"entityName",label:"Entity",align:"center"}),e(G,{prop:"purchaseAmount",label:"Financing Amount",align:"center"}),e(G,{prop:"currentTotalReturn",label:"Interest Return",align:"center"})]),_:1},8,["data"])])):W("",!0),l(k)?(u(),_("div",fl,[pl,e(ce,{data:l(w).commissionHistoryResponses,height:"240","row-style":{height:"30px"},"header-cell-style":{background:"#BE9670",color:"#fff"}},{default:n(()=>[e(G,{prop:"dividendDate",label:"Commission Payment Date",align:"center"}),e(G,{prop:"dividendAmount",label:"Commission Return",align:"center"})]),_:1},8,["data"])])):W("",!0)]),e(Pe,{modelValue:l(v),"onUpdate:modelValue":t[14]||(t[14]=a=>H(v)?v.value=a:null),title:""},{footer:n(()=>[r("span",ml,[e(g,{onClick:t[12]||(t[12]=a=>v.value=!1)},{default:n(()=>[R("Cancel")]),_:1}),e(g,{type:"primary",onClick:t[13]||(t[13]=a=>x(l(J)))},{default:n(()=>[R(" Confirm ")]),_:1})])]),default:n(()=>[e(ue,{model:l(c),ref_key:"formRef",ref:J,rules:l(Z)},{default:n(()=>[e(d,{label:"Client",prop:"clientId"},{default:n(()=>[e(y,{modelValue:l(c).clientId,"onUpdate:modelValue":t[10]||(t[10]=a=>l(c).clientId=a),placeholder:"Please Client",filterable:"",clearable:"",onChange:oe},{default:n(()=>[(u(!0),_(L,null,B(l(O),(a,m)=>(u(),z(h,{label:a.name,value:a.id,key:m},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"Entity",prop:"entityId"},{default:n(()=>[e(y,{modelValue:l(c).entityId,"onUpdate:modelValue":t[11]||(t[11]=a=>l(c).entityId=a),placeholder:"Please Entity Name",filterable:"",clearable:""},{default:n(()=>[(u(!0),_(L,null,B(l(P),(a,m)=>(u(),z(h,{label:a.entityName,value:a.id,key:m},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}});const ve=$e(_l,[["__scopeId","data-v-6acc49cb"]]),re=A=>(Ne("data-v-11513e68"),A=A(),xe(),A),vl={class:"referral"},gl=re(()=>r("div",{class:"title"},"Referral List",-1)),yl={class:"tool-box"},bl={class:"flex"},Il={class:"table"},hl={class:"table-name"},Cl={class:"pointer"},Rl={class:"action"},kl=["onClick"],wl=re(()=>r("span",null,"Are you sure to delete this?",-1)),El={class:"dialog-footer"},Vl={class:"pagination"},Nl=re(()=>r("div",null,null,-1)),xl=ge({__name:"index",setup(A){const{setBreadcrumbList:k}=Ge(),U=p(),O=p(!0),K=[{name:"add",component:ve},{name:"edit",component:ve}],F=p(null),P=[{value:0,label:"Client",name:"clientId"},{value:1,label:"Entity",name:"entityId"},{value:2,label:"Fund",name:"fundId"}],w=p(null),E=p(""),Y=p([]),J=p(0),i=p(10),v=p(1),j=p(null),C=p(!1);ye(()=>{N()});async function N(){var M,x,T;F.value=null;let b={pageSize:i.value,pageNum:v.value},f={};w.value!==null&&(f={[P[w.value].name]:E.value});const[D,V]=await S.queryReferral(f,b);O.value=!1,!D&&V?(console.log((M=V.data)==null?void 0:M.list),J.value=((x=V.data)==null?void 0:x.total)||0,Y.value=((T=V.data)==null?void 0:T.list)||[]):console.log(D)}const c=b=>{v.value=b,N()},Z=()=>{w.value=null,E.value="",v.value=1,N()},le=()=>{v.value=1,N()},te=()=>{k([{name:"Create Referral"}]),F.value=K.findIndex(b=>b.name==="add"),j.value=null,U.value.handleIsShow()},ae=b=>{k([{name:"Edit Referral"}]),F.value=K.findIndex(f=>f.name==="edit"),j.value=b.id,U.value.handleIsShow()},ne=()=>{C.value=!0},oe=async b=>{const f={id:b.id},[D,V]=await S.delReferral(f);!D&&V&&(V.data&&X.success("delete success"),C.value=!1,N())};return _e(Le,{func:()=>{U.value&&U.value.handleIsShow()}}),_e(Ae,{rId:j}),(b,f)=>{const D=Ce,V=Re,M=ke,x=he,T=Ie,I=we,s=Ve,t=Ke,o=Ee,g=Ye,h=ze,y=Oe;return u(),_(L,null,[Be((u(),_("div",vl,[gl,r("div",yl,[r("div",bl,[e(V,{class:"select",modelValue:l(w),"onUpdate:modelValue":f[0]||(f[0]=d=>H(w)?w.value=d:null),clearable:"",placeholder:"Filter by"},{default:n(()=>[(u(),_(L,null,B(P,d=>e(D,{key:d.value,label:d.label,value:d.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e(M,{modelValue:l(E),"onUpdate:modelValue":f[1]||(f[1]=d=>H(E)?E.value=d:null),class:"m-lr-20",placeholder:"Search","prefix-icon":l(je),clearable:""},null,8,["modelValue","prefix-icon"]),e(x,{class:"text-white",type:"primary",color:"#BE9670",onClick:le},{default:n(()=>[R(" Search ")]),_:1}),e(x,{class:"text-828282",type:"primary",color:"#E8E8E8",onClick:Z},{default:n(()=>[R(" Clear ")]),_:1})]),r("div",null,[e(x,{type:"primary",color:"#4E9F1C",onClick:te},{default:n(()=>[R(" New Referral "),e(T,null,{default:n(()=>[e(l(be))]),_:1})]),_:1})])]),r("div",Il,[l(Y).length>0?(u(),z(o,{key:0,data:l(Y),height:"600","row-style":{height:"80px"}},{default:n(()=>[e(I,{prop:"id",label:"Referral ID",align:"center",width:"100",fixed:"left"}),e(I,{prop:"name",label:"Entity",align:"left",width:"150",fixed:"left"},{default:n(d=>[r("div",hl,[r("span",null,q(d.row.entityName),1)])]),_:1}),e(I,{prop:"clientName",label:"Client",align:"left",width:"150"}),e(I,{prop:"fundName",label:"Fund",width:"200"}),e(I,{prop:"commissionRate",label:"Commission Rate",width:"150",align:"center"}),e(I,{prop:"commissionAmount",label:"Commission Amount",width:"200",align:"center"}),e(I,{prop:"financingAmount",label:"Total Financing Amount",width:"200",align:"center"}),e(I,{prop:"currency",label:"Currency",width:"150",align:"center"}),e(I,{prop:"createAt",label:"Create at",width:"200"}),e(I,{prop:"",label:"Action",align:"center",fixed:"right"},{default:n(d=>[r("div",Cl,[e(t,{placement:"bottom",width:170,trigger:"hover"},{reference:n(()=>[e(T,{size:30,color:"#969696"},{default:n(()=>[e(l(Me))]),_:1})]),default:n(()=>[r("div",Rl,[r("div",{class:"item",onClick:$=>ae(d.row)},"Edit",8,kl),r("div",{class:"item",onClick:f[2]||(f[2]=$=>ne())},"Delete"),e(s,{modelValue:l(C),"onUpdate:modelValue":f[4]||(f[4]=$=>H(C)?C.value=$:null),title:"Message",width:"30%","align-center":""},{footer:n(()=>[r("span",El,[e(x,{onClick:f[3]||(f[3]=$=>C.value=!1)},{default:n(()=>[R("Cancel")]),_:1}),e(x,{type:"primary",onClick:$=>oe(d.row)},{default:n(()=>[R(" Confirm ")]),_:2},1032,["onClick"])])]),default:n(()=>[wl]),_:2},1032,["modelValue"])])]),_:2},1024)])]),_:1})]),_:1},8,["data"])):(u(),z(g,{key:1,"image-size":200}))]),r("div",Vl,[Nl,e(h,{background:"",layout:"total,consists of sizes, prev, pager, next, jumper, ->, slot",total:l(J),"page-size":l(i),"onUpdate:pageSize":f[5]||(f[5]=d=>H(i)?i.value=d:null),"current-page":l(v),"onUpdate:currentPage":f[6]||(f[6]=d=>H(v)?v.value=d:null),onCurrentChange:c},null,8,["total","page-size","current-page"])])])),[[y,l(O)]]),e(l(Se),{ref_key:"rightPanel",ref:U,onBackFn:N},{content:n(()=>[l(F)!==null?(u(),z(He(K[l(F)].component),{key:0})):W("",!0)]),_:1},512)],64)}}});const Ml=$e(xl,[["__scopeId","data-v-11513e68"]]);export{Ml as default};
