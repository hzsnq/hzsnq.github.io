import{a as Y}from"./index-35b0e3a1.js";/* empty css                   *//* empty css                 *//* empty css                 *//* empty css                */import{d as G,r as u,o as Q,a6 as fe,b as c,h as f,j as i,F as A,i as j,t as T,g as l,f as a,e as s,l as k,c as S,a7 as ee,m as M,K as ge,an as ye,ao as be,R as te,x as le,y as ae,_ as ne,a as he,a5 as X,U as B,a3 as Ce,O as we,X as Ee,Y as ke,a8 as Se,a9 as Ie,S as xe,aa as Ae,k as Ve,a2 as De,W as $e,E as Be,a0 as Te,Z as Ne}from"./index-5a0eb1b1.js";import{u as oe}from"./AppMain.vue_vue_type_style_index_0_scoped_41d4e859_lang-bdfc2e53.js";import{i as Z,_ as Re}from"./index-79b2cd3e.js";/* empty css                             */import{P as se}from"./index-e099722b.js";import"./useUser-46e05e2c.js";const ie=Symbol("audit"),Pe=g=>(le("data-v-373fd800"),g=g(),ae(),g),je={class:"pop-top"},Ue={class:"title"},qe=Pe(()=>i("div",null,null,-1)),ze={class:"form"},Oe={class:"block padding-b-20"},Le={class:"block padding-t-20 padding-b-20"},Fe={class:"btn-group"},Ye=G({__name:"ViewAudit",setup(g){const{breadcrumbList:O}=oe(),{aId:C}=Z(ie),{func:V}=Z(se),y=u({});Q(()=>{U()});async function U(){var d,p,v,o;let D={id:C.value};const[m,t]=await Y.queryAuditById(D);if(!m&&t){if(console.log(t.data),(d=t.data)!=null&&d.newEntity&&(t.data.newEntity=JSON.parse((p=t.data)==null?void 0:p.newEntity)),(v=t.data)!=null&&v.entityContent){t.data.entityContent=JSON.parse((o=t.data)==null?void 0:o.entityContent);let _=Object.entries(t.data.entityContent);const b=[];for(let r=0;r<_.length;r++){let N=Object.entries(_[r][1]),R={name:`current ${_[r][0]}`,value:N[0][0]},w={name:`new ${_[r][0]}`,value:N[0][1]};b.push(R),b.push(w)}console.log(b),t.data.entityContentShow=b}y.value=(t==null?void 0:t.data)||{}}}const I=async D=>{let m={id:C.value,status:D};const[t,d]=await Y.editAudit(m);!t&&d&&(ge.success("Change successfully"),setTimeout(()=>{V()},1e3))},q=()=>{V()};return(D,m)=>{const t=ye,d=be,p=te,v=fe("permission");return c(),f(A,null,[i("div",je,[i("div",Ue,[(c(!0),f(A,null,j(l(O),(o,_)=>(c(),f("span",{key:_},T(o.name),1))),128)),i("span",null," - ID:"+T(l(C)),1)]),qe]),i("div",ze,[i("div",Oe,[a(d,{title:"",column:1,border:""},{default:s(()=>[a(t,{label:"Account Email","label-align":"center",align:"center"},{default:s(()=>{var o;return[k(T((o=l(y))==null?void 0:o.creatorName),1)]}),_:1}),a(t,{label:"Client ID","label-align":"center",align:"center"},{default:s(()=>{var o;return[k(T((o=l(y))==null?void 0:o.name),1)]}),_:1})]),_:1})]),i("div",Le,[a(d,{title:l(y).auditType,column:1,border:""},{default:s(()=>[(c(!0),f(A,null,j(l(y).entityContentShow,(o,_)=>(c(),S(t,{label:o.name,"label-align":"center",align:"center",key:_},{default:s(()=>[k(T(o.value),1)]),_:2},1032,["label"]))),128))]),_:1},8,["title"])]),i("div",Fe,[ee((c(),f("div",null,[l(y).status!=="Approved"?(c(),S(p,{key:0,color:"#4E9F1C",onClick:m[0]||(m[0]=o=>I("Approved"))},{default:s(()=>[k("Approve")]),_:1})):M("",!0),l(y).status!=="Approved"?(c(),S(p,{key:1,color:"#DC0000",onClick:m[1]||(m[1]=o=>I("Rejected"))},{default:s(()=>[k("Reject")]),_:1})):M("",!0)])),[[v,"Audit"]]),a(p,{class:"text-white m-l-20",color:"#BDBDBD",onClick:q},{default:s(()=>[k("Cancel")]),_:1})])])],64)}}});const Me=ne(Ye,[["__scopeId","data-v-373fd800"]]),K=g=>(le("data-v-81b29491"),g=g(),ae(),g),Ke={class:"audit"},He=K(()=>i("div",{class:"title"},"Audit List",-1)),Je={class:"tool-box"},We={class:"flex"},Xe=K(()=>i("div",null,null,-1)),Ze={class:"table"},Ge={class:"pointer"},Qe={class:"action"},et=["onClick"],tt={class:"pagination"},lt=K(()=>i("div",null,null,-1)),at=G({__name:"index",setup(g){var W;const{setBreadcrumbList:O}=oe(),C=u(),V=u(!0),y=he(),U=[{name:"view",component:Me}],I=u(null),q=[{value:0,label:"Email",name:"creatorName"}],D=u([{code:"Client Update"},{code:"Re-Investment request"},{code:"Entity Update"}]),m=u([{code:"Approved"},{code:"Rejected"},{code:"Pending approval"}]),t=u(null),d=u(null),p=u(null),v=u(""),o=u([]),_=u(0),b=u(10),r=u(1),N=u(null),R=u(((W=y.currentRoute.value.query)==null?void 0:W.aId)||"");Q(()=>{w()});async function w(){var z,P,h;I.value=null;let x={pageSize:b.value,pageNum:r.value},n={};t.value!==null&&(n={[q[t.value].name]:v.value}),p.value!==null&&(n={...n,status:p.value}),d.value!==null&&(n={...n,auditType:d.value}),V.value=!1;const[$,E]=await Y.queryAudit(n,x);if(V.value=!1,!$&&E){if(console.log((z=E.data)==null?void 0:z.list),_.value=((P=E.data)==null?void 0:P.total)||0,o.value=((h=E.data)==null?void 0:h.list)||[],R.value){const L=o.value.find(F=>F.id===Number(R.value));H(L),R.value=""}}else console.log($)}const ce=x=>{r.value=x,w()},ue=()=>{t.value=null,v.value="",r.value=1,w()},de=()=>{r.value=1,w()},H=async x=>{O([{name:`${x.auditType} Request`}]),I.value=U.findIndex(n=>n.name==="view"),N.value=x.id,C.value.handleIsShow()},re=()=>{C.value&&C.value.handleIsShow()},J=()=>{w()};return X(se,{func:re}),X(ie,{aId:N}),(x,n)=>{const $=De,E=Ce,z=we,P=te,h=$e,L=Be,F=Te,pe=Ee,_e=Ne,me=ke,ve=Se;return c(),f(A,null,[ee((c(),f("div",Ke,[He,i("div",Je,[i("div",We,[a(E,{class:"select",modelValue:l(t),"onUpdate:modelValue":n[0]||(n[0]=e=>B(t)?t.value=e:null),clearable:"",placeholder:"Filter by"},{default:s(()=>[(c(),f(A,null,j(q,e=>a($,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a(z,{modelValue:l(v),"onUpdate:modelValue":n[1]||(n[1]=e=>B(v)?v.value=e:null),class:"m-lr-20 width-200",placeholder:"Search","prefix-icon":l(Ie),clearable:""},null,8,["modelValue","prefix-icon"]),a(P,{class:"text-white",type:"primary",color:"#BE9670",onClick:de},{default:s(()=>[k(" Search ")]),_:1}),a(P,{class:"text-828282",type:"primary",color:"#E8E8E8",onClick:ue},{default:s(()=>[k(" Clear ")]),_:1}),a(E,{class:"select m-l-20",modelValue:l(d),"onUpdate:modelValue":n[2]||(n[2]=e=>B(d)?d.value=e:null),clearable:"",placeholder:"Type",onChange:J},{default:s(()=>[(c(!0),f(A,null,j(l(D),e=>(c(),S($,{key:e.code,label:e.code,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(E,{class:"select m-l-20",modelValue:l(p),"onUpdate:modelValue":n[3]||(n[3]=e=>B(p)?p.value=e:null),clearable:"",placeholder:"Status",onChange:J},{default:s(()=>[(c(!0),f(A,null,j(l(m),e=>(c(),S($,{key:e.code,label:e.code,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),Xe]),i("div",Ze,[l(o).length>0?(c(),S(pe,{key:0,data:l(o),height:"600","row-style":{height:"80px"}},{default:s(()=>[a(h,{prop:"id",label:"Request ID",align:"center"}),a(h,{prop:"auditType",label:"Type",align:"left"}),a(h,{prop:"creatorName",label:"Email",align:"left"}),a(h,{prop:"status",label:"Status"}),a(h,{prop:"updatedAt",label:"Request Time"},{default:s(e=>[i("span",null,T(l(xe)(e.row.updatedAt).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1}),a(h,{prop:"",label:"Action",align:"center"},{default:s(e=>[i("div",Ge,[a(F,{placement:"bottom",width:170,trigger:"hover"},{reference:s(()=>[a(L,{size:30,color:"#969696"},{default:s(()=>[a(l(Ae))]),_:1})]),default:s(()=>[i("div",Qe,[i("div",{class:"item",onClick:nt=>H(e.row)},"View",8,et)])]),_:2},1024)])]),_:1})]),_:1},8,["data"])):(c(),S(_e,{key:1,"image-size":200}))]),i("div",tt,[lt,a(me,{background:"",layout:"total,consists of sizes, prev, pager, next, jumper, ->, slot",total:l(_),"page-size":l(b),"onUpdate:pageSize":n[4]||(n[4]=e=>B(b)?b.value=e:null),"current-page":l(r),"onUpdate:currentPage":n[5]||(n[5]=e=>B(r)?r.value=e:null),onCurrentChange:ce},null,8,["total","page-size","current-page"])])])),[[ve,l(V)]]),a(l(Re),{ref_key:"rightPanel",ref:C,onBackFn:w},{content:s(()=>[l(I)!==null?(c(),S(Ve(U[l(I)].component),{key:0})):M("",!0)]),_:1},512)],64)}}});const ft=ne(at,[["__scopeId","data-v-81b29491"]]);export{ft as default};
